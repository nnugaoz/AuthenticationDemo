<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <meta charset="utf-8" />
    <script src="../../JavaScript/jQuery/jquery-3.4.1.min.js"></script>
    <script src="../../JavaScript/Common/Common.js"></script>
    <script type="text/javascript">
        $(function () {
            var lID = getParameterByName("ID", window.location.href);

            $.ajax({
                type: "post"
                , url: "/Handler/user.ashx?RequestMethod=USER_EDIT_INIT&ID=" + lID
                , success: function (pData) {
                    var lData = JSON.parse(pData);

                    var lHtml = "";
                    for (var i = 0; i < lData.RoleList.length; i++) {
                        lHtml += "<input type='checkbox' name='chkRole' value='" + lData.RoleList[i].ID + "' id='chkRole" + i + "' /><label for='chkRole" + i + "'>" + lData.RoleList[i].RName + "</label>";
                    }
                    $("#roleList").html(lHtml);

                    var lRoleList = new Array();
                    if (lData.UserSingle.length > 0) {
                        $("#txtID").val(lData.UserSingle[0].ID);
                        $("#txtUserName").val(lData.UserSingle[0].UserName);
                        lRoleList = lData.UserSingle[0].RIDS.split(';');
                    }

                    for (var i = 0; i < lRoleList.length; i++) {
                        if (lRoleList[i] != "") {
                            $("input[name=chkRole][value=" + lRoleList[i] + "]").prop("checked", true);
                        }
                    }
                }
            });

            $("#btnSubmit").click(function (event) {
                var lRet = false;
                $("input[name=chkRole]").each(function (index, element) {
                    if ($(element).prop("checked")) {
                        lRet = true;
                        $("#txtRIDS").val($("#txtRIDS").val() + $(element).val() + ";");
                    }
                });

                return lRet;
            })
        });
    </script>
</head>
<body>
    <form>
        <input type="hidden" id="txtID" name="txtName" />
        用户名:<input type="text" id="txtUserName" name="txtUserName" /><br />
        角色列表:<div id="roleList"></div>
        <input type="hidden" id="txtRIDS" name="txtRIDS" />
        <input type="submit" id="btnSubmit" name="btnSubmit" value="提交" />
    </form>
</body>
</html>
