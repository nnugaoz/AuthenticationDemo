<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <link href="../../JavaScript/zTree/css/zTreeStyle/zTreeStyle.css" rel="stylesheet" />
    <script src="../../JavaScript/jQuery/jquery-3.4.1.min.js"></script>
    <script src="../../JavaScript/zTree/js/jquery.ztree.core.min.js"></script>
    <script src="../../JavaScript/zTree/js/jquery.ztree.excheck.min.js"></script>
    <script src="../../JavaScript/zTree/js/jquery.ztree.exedit.min.js"></script>
    <script type="text/javascript">
        $(function () {
            InitSysFeatureList();

            $("#lnkAdd").click(function () {
                var lSysFeatureTreeObj = $.fn.zTree.getZTreeObj("SysFeatureTree");
                var lSelectedNodes = lSysFeatureTreeObj.getSelectedNodes();
                var lSelectedNodeID = "";
                var lSelectedNodeName = "";
                if (lSelectedNodes.length > 0) {
                    lSelectedNodeID = lSelectedNodes[0].ID;
                    lSelectedNodeName = lSelectedNodes[0].FeatureName;
                }
                window.location.href = "FeatureAdd.html?ParentID=" + lSelectedNodeID + "&ParentName=" + lSelectedNodeName;
            });

            $("#lnkEdit").click(function () {
                var lSysFeatureTreeObj = $.fn.zTree.getZTreeObj("SysFeatureTree");
                var lSelectedNodes = lSysFeatureTreeObj.getSelectedNodes();
                var lSelectedNodeID = "";
                var lSelectedNodeName = "";
                var lSelectedNodeAddr = "";
                if (lSelectedNodes.length > 0) {
                    lSelectedNodeID = lSelectedNodes[0].ID;
                    lSelectedNodeName = lSelectedNodes[0].FeatureName;
                    lSelectedNodeAddr = lSelectedNodes[0].Addr;
                }
                window.location.href = "FeatureEdit.html?ID=" + lSelectedNodeID + "&Name=" + lSelectedNodeName + "&Addr=" + lSelectedNodeAddr;
            })
        });

        function InitSysFeatureList() {
            var ztreeSettings = {
                data: {
                    simpleData: {
                        enable: true
                        , idKey: "ID"
                        , pIdKey: "PID"
                    }
                     , key: {
                         name: "FeatureName"
                        , title: "FeatureName"
                     }
                }
                , view: {
                    showLine: false
                    , selectedMulti: false
                }

                , callback: {
                    onClick: InitSysFeatureList_OnClick
                }
            };

            var ztreeNodes = [];
            $.ajax({
                type: "get"
                , url: "../../Handler/Feature.ashx?RequestMethod=Feature_LIST"
                , success: function (pData) {
                    var lData = JSON.parse(pData);
                    ztreeNodes = lData.Table;

                    $.fn.zTree.init($("#SysFeatureTree"), ztreeSettings, ztreeNodes);
                }
            });
        }

        function InitSysFeatureList_OnClick(event, treeId, treeNode, clickFlag) {

        }


    </script>
</head>
<body>
    系统功能列表
    <div id="SysFeatureTree" class="ztree">

    </div>
    <a href="javascript:void(0);" id="lnkAdd" name="lnkAdd">添加</a>
    <a href="javascript:void(0);" id="lnkEdit" name="lnkEdit">编辑</a>
</body>
</html>
