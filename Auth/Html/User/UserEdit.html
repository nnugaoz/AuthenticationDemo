<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <meta charset="utf-8" />

    <link href="/JavaScript/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="/JavaScript/jQuery/jquery-3.4.1.min.js"></script>
    <script src="/JavaScript/Common/Common.js"></script>
    <script src="/JavaScript/Common/Pagination.js"></script>
    <script type="text/javascript">
        if (!LoginCheck()) {
            window.location.href = "/Html/login.html";
        }

        $(function () {
            console.log("Initialized");
            PageInit();
        });

        function PageInit() {
            $("#roleList").empty();
            var lPageConfig = new PaginationConfiguration();
            lPageConfig.RequestUrl = "/Handler/Role.ashx?RequestMethod=ROLE_LIST_PAGE";
            lPageConfig.PageContainerID = "roleList";

            var lChkCol = new PaginationColumnConfiguration();
            lChkCol.Type = "CHK";
            lChkCol.HeaderText = "选择";
            lChkCol.PWidth = "10%";
            lChkCol.OnClickEventHandler = RoleList_ChkCol_OnClick;
            lPageConfig.Columns.push(lChkCol);

            var lRoleNameCol = new PaginationColumnConfiguration();
            lRoleNameCol.Type = "TXT";
            lRoleNameCol.HeaderText = "角色名称";
            lRoleNameCol.DataField = "RName";
            lPageConfig.Columns.push(lRoleNameCol);

            var lPageObj = new Pagination(lPageConfig);
            lPageObj.RequestData(1);

            var lID = GetParameterByName("ID");

            $.ajax({
                type: "POST"
                , url: "/Handler/User.ashx?RequestMethod=USER_EDIT_INIT&ID=" + lID
                , success: function (pData) {
                    var lData = JSON.parse(pData);

                    var lRoleList = new Array();
                    if (lData.UserSingle.length > 0) {
                        $("#txtID").val(lData.UserSingle[0].ID);
                        $("#txtUserName").val(lData.UserSingle[0].UserName);
                        lRoleList = lData.UserSingle[0].RIDS.split(';');
                    }

                    for (var i = 0; i < lRoleList.length; i++) {
                        if (lRoleList[i] != "") {
                            $("input[name=chkRole][value=" + lRoleList[i] + "]").prop("checked", true);
                        }
                    }
                }
            });

            //$("#btnSubmit").click(function (event) {
            //    var lRet = false;
            //    $("input[name=chkRole]").each(function (index, element) {
            //        if ($(element).prop("checked")) {
            //            lRet = true;
            //            $("#txtRIDS").val($("#txtRIDS").val() + $(element).val() + ";");
            //        }
            //    });
            //    return lRet;
            //});

        }

        function RoleList_ChkCol_OnClick(event) {
            console.log("check clicked!");
        }
    </script>
</head>
<body>
    <form class="container">
        <div class="form-group">
            <label for="txtUserName">用户名</label>
            <input type="text" id="txtUserName" name="txtUserName" class="form-control" /><br />
        </div>
        <label for="RoleList">角色列表</label>
        <div id="roleList">

        </div>
        <div style="margin-top:20px;"></div>
        <input type="button" id="btnSubmit" name="btnSubmit" value="提交" class="btn btn-primary" />
        <input type="hidden" id="txtID" name="txtName" />
        <input type="hidden" id="txtRIDS" name="txtRIDS" />
    </form>
</body>
</html>
